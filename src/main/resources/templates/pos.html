<!doctype html>
<html lang="es" data-bs-theme="dark">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Punto de Venta (POS)</title>
    <!-- Bootstrap 5.3 -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
    <!-- Bootstrap Icons -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet" />
    <!-- Estilos personalizados -->
    <link href="/css/pos_styles.css" rel="stylesheet">
    <link href="/css/adm_styles.css" rel="stylesheet">
</head>

<body>
    <main class="container-fluid py-3">
        <!-- Header -->
        <header class="d-flex align-items-center justify-content-between mb-4">
            <div class="back-button me-3">
                <button class="btn btn-outline-secondary" onclick="history.back()">
                    <i class="bi bi-arrow-left"></i> Volver
                </button>
            </div>
            <h1 class="h3 m-0">Punto de Venta</h1>
            <div class="user_info">
                <span th:text="${username}">Usuario</span> <i class="bi bi-person"></i>
            </div>
        </header>

        <!-- Top toolbar -->
        <div class="row g-3 align-items-end mb-2">
            <div class="col-12 col-lg-6">
                <div class="input-group search-scan">
                    <span class="input-group-text"><i class="bi bi-upc-scan"></i></span>
                    <input id="scanInput" type="text" class="form-control" placeholder="Escribe SKU o nombre" />
                    <button id="btnBuscar" class="btn btn-primary"><i class="bi bi-search"></i></button>
                </div>
            </div>
            <div class="col-6 col-lg-3">
                <select id="clienteSelect" class="form-select" aria-label="Selecciona cliente">
                    <option value="general">Cliente General</option>
                    <option value="mayoreo">Cliente Mayoreo</option>
                </select>
            </div>
            <div class="col-6 col-lg-3">
                <div class="input-group">
                    <span class="input-group-text"><i class="bi bi-percent"></i></span>
                    <input id="descuentoInput" type="number" min="0" max="100" step="1" class="form-control"
                        placeholder="Descuento %" />
                </div>
            </div>
        </div>

        <section class="pos-wrapper">
            <!-- Productos -->
            <aside class="card order-2 order-xl-1">
                <div class="card-header d-flex justify-content-between align-items-center">
                    <span class="fw-semibold"><i class="bi bi-grid-3x3-gap"></i> Catálogo</span>
                    <div class="d-flex gap-2">
                        <div class="dropdown">
                            <button class="btn btn-sm btn-outline-secondary dropdown-toggle"
                                data-bs-toggle="dropdown"><i class="bi bi-sort-down"></i></button>
                            <ul class="dropdown-menu dropdown-menu-end">
                                <li><a class="dropdown-item" href="#" data-sort="name">Nombre</a></li>
                                <li><a class="dropdown-item" href="#" data-sort="price">Precio</a></li>
                                <li><a class="dropdown-item" href="#" data-sort="stock">Stock</a></li>
                            </ul>
                        </div>
                    </div>
                </div>
                <div class="card-body">
                    <div id="gridProductos" class="row row-cols-2 row-cols-md-3 row-cols-xxl-4 g-2">
                        <div class="col" th:each="p : ${productos}">
                            <div class="card h-100 shadow-sm">
                                <!-- Info producto -->
                                <div class="card-body d-flex flex-column">
                                    <h6 class="card-title mb-1" th:text="${p.nombre}">Nombre Producto</h6>
                                    <small class="text-muted">SKU: <span th:text="${p.codigo}"></span></small>
                                    <p class="fw-bold text-primary mt-2 mb-3"
                                        th:text="'$' + ${#numbers.formatDecimal(p.precio, 1, 'POINT', 2, 'NONE')}">
                                        Precio</p>

                                    <!-- Botón agregar al carrito -->
                                    <button class="btn btn-sm btn-success mt-auto" th:attr="data-id=${p.id}, 
                                 data-nombre=${p.nombre}, 
                                 data-precio=${p.precio}">
                                        <i class="bi bi-cart-plus"></i> Agregar
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>

                </div>
            </aside>

            <!-- Carrito -->
            <section class="card order-1 order-xl-2">
                <div class="card-header d-flex justify-content-between align-items-center">
                    <span class="fw-semibold"><i class="bi bi-bag"></i> Carrito</span>
                    <div class="d-flex gap-2">
                        <button id="btnHold" class="btn btn-outline-secondary btn-sm"><i class="bi bi-pause-circle"></i>
                            Guardar</button>
                        <button id="btnClear" class="btn btn-outline-danger btn-sm"><i class="bi bi-trash"></i>
                            Vaciar</button>
                    </div>
                </div>
                <div class="card-body p-0">
                    <div class="table-responsive" style="max-height: 52vh;">
                        <table class="table align-middle cart-table m-0">
                            <thead class="table-dark sticky-col">
                                <tr>
                                    <th>Producto</th>
                                    <th class="text-center" style="width:140px">Cantidad</th>
                                    <th class="text-end" style="width:120px">Precio</th>
                                    <th class="text-end" style="width:120px">Importe</th>
                                    <th class="text-center" style="width:40px"></th>
                                </tr>
                            </thead>
                            <tbody id="cartBody"></tbody>
                        </table>
                    </div>
                </div>
            </section>

            <!-- Totales / Acciones -->
            <aside class="card totals-card order-3">
                <div class="card-header"><i class="bi bi-cash-coin"></i> Totales</div>
                <div class="card-body">
                    <ul class="list-group list-group-flush mb-3">
                        <li class="list-group-item"><span>Subtotal</span><strong id="subtotalTxt">$0.00</strong></li>
                        <li class="list-group-item d-flex align-items-center justify-content-between">
                            <div class="d-flex align-items-center gap-2"><span>Descuento</span>
                                <span class="text-muted" id="descLabel"></span>
                            </div>
                            <strong id="descuentoTxt">-$0.00</strong>
                        </li>
                        <li class="list-group-item d-flex align-items-center justify-content-between">
                            <div class="form-check form-switch m-0">
                                <input class="form-check-input" type="checkbox" id="ivaSwitch" checked>
                                <label class="form-check-label" for="ivaSwitch">IVA 16%</label>
                            </div>
                            <strong id="ivaTxt">$0.00</strong>
                        </li>
                        <li class="list-group-item"><span>Total</span><strong id="totalTxt" class="fs-5">$0.00</strong>
                        </li>
                    </ul>
                    <div class="d-grid gap-2">
                        <button id="btnCobrar" class="btn btn-primary btn-lg"><i class="bi bi-credit-card"></i>
                            Cobrar</button>
                    </div>
                </div>
            </aside>
        </section>
    </main>

    <!-- Modal Pago -->
    <div class="modal fade" id="modalPago" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Cobrar</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="mb-3">
                        <label class="form-label">Método</label>
                        <div class="btn-group w-100" role="group">
                            <input type="radio" class="btn-check" name="metodoPago" id="mpEfectivo" value="efectivo"
                                checked>
                            <label class="btn btn-outline-primary" for="mpEfectivo"><i class="bi bi-cash"></i>
                                Efectivo</label>
                            <input type="radio" class="btn-check" name="metodoPago" id="mpTarjeta" value="tarjeta">
                            <label class="btn btn-outline-primary" for="mpTarjeta"><i
                                    class="bi bi-credit-card-2-front"></i> Transferencia </label>
                            <input type="radio" class="btn-check" name="metodoPago" id="mpMixto" value="mixto">
                            <label class="btn btn-outline-primary" for="mpMixto"><i class="bi bi-shuffle"></i>
                                Mixto</label>
                        </div>
                    </div>
                    <div class="row g-2" id="sectionEfectivo">
                        <div class="col-6">
                            <label class="form-label">Recibido</label>
                            <input id="recibidoInput" type="number" step="0.01" class="form-control" placeholder="0.00">
                        </div>
                        <div class="col-6">
                            <label class="form-label">Cambio</label>
                            <input id="cambioInput" type="text" class="form-control" value="$0.00" disabled>
                        </div>
                    </div>
                    <div id="sectionMixto" class="mt-2 d-none">
                        <div class="row g-2">
                            <div class="col-6">
                                <label class="form-label">Efectivo</label>
                                <input id="mixtoEfectivo" type="number" step="0.01" class="form-control"
                                    placeholder="0.00">
                            </div>
                            <div class="col-6">
                                <label class="form-label">Tarjeta</label>
                                <input id="mixtoTarjeta" type="number" step="0.01" class="form-control"
                                    placeholder="0.00">
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer d-flex justify-content-between">
                    <div class="fw-semibold">Total a cobrar: <span id="totalCobrarTxt">$0.00</span></div>
                    <div>
                        <button class="btn btn-outline-secondary" data-bs-dismiss="modal">Cancelar</button>
                        <button id="btnConfirmarPago" class="btn btn-primary">Confirmar</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- Bootstrap JS Bundle -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script th:inline="javascript">
        /*<![CDATA[*/
        const productos = /*[[${productos}]]*/[];
        /*]]>*/
    </script>
    <script src="/js/pos.js"></script>
</body>

</html>